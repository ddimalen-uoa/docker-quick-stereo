FROM php:5.6-fpm-stretch

# âœ… Use only the archived Stretch repo; trust it to avoid signature/valid-until failures
RUN set -eux; \
    rm -f /etc/apt/sources.list.d/*; \
    printf 'deb [check-valid-until=no trusted=yes] http://archive.debian.org/debian stretch main contrib non-free\n' > /etc/apt/sources.list; \
    printf 'Acquire::Check-Valid-Until "false";\n' > /etc/apt/apt.conf.d/99no-check-valid; \
    apt-get -o Acquire::Check-Valid-Until=false update; \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        libfreetype6-dev libjpeg62-turbo-dev libpng-dev; \
    docker-php-ext-configure gd \
        --with-freetype-dir=/usr/include/ \
        --with-jpeg-dir=/usr/include/; \
    docker-php-ext-install -j"$(nproc)" gd mysql mysqli pdo_mysql; \
    apt-get purge -y --auto-remove libfreetype6-dev libjpeg62-turbo-dev libpng-dev; \
    rm -rf /var/lib/apt/lists/*

WORKDIR /var/www